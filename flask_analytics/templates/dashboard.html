{% extends "base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥{% endblock %}

{% block content %}
<h1 class="mb-4">üìä –î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</h1>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card bg-primary">
            <h3>{{ "%.0f"|format(stats.total_orders|default(0)) }}</h3>
            <p>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-success">
            <h3>{{ "%.2f"|format(stats.total_revenue|float|default(0)) }} ‚ÇΩ</h3>
            <p>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-info">
            <h3>{{ "%.0f"|format(stats.active_customers|default(0)) }}</h3>
            <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card bg-warning text-dark">
            <h3>{{ "%.2f"|format(stats.avg_order_value|float|default(0)) }} ‚ÇΩ</h3>
            <p>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</p>
        </div>
    </div>
</div>

{% if today_stats %}
<div class="card mb-4">
    <div class="card-header">
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è ({{ today_date }})
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p>–ó–∞–∫–∞–∑–æ–≤: <strong>{{ today_stats.today_orders }}</strong></p>
            </div>
            <div class="col-md-6">
                <p>–í—ã—Ä—É—á–∫–∞: <strong>{{ "%.2f"|format(today_stats.today_revenue|float|default(0)) }} ‚ÇΩ</strong></p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ 7 –¥–Ω–µ–π</div>
            <div class="card-body">
                {% if weekly_sales %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for day in weekly_sales %}
                            <tr>
                                <td>{{ day.date }}</td>
                                <td>{{ day.orders_count }}</td>
                                <td>{{ "%.2f"|format(day.daily_revenue|float|default(0)) }} ‚ÇΩ</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –≤—ã—Ä—É—á–∫–µ</div>
            <div class="card-body">
                {% if top_categories %}
                <div class="list-group">
                    {% for cat in top_categories %}
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ cat.category }}</strong>
                                <div class="text-muted small">–ü—Ä–æ–¥–∞–Ω–æ: {{ cat.items_sold }} —à—Ç.</div>
                            </div>
                            <div class="text-end">
                                <div class="fw-bold">{{ "%.2f"|format(cat.revenue|float|default(0)) }} ‚ÇΩ</div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
    </div>
    <div class="card-body">
        <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:</strong> PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Django –ø—Ä–æ–µ–∫—Ç–∞</p>
        <p><strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:</strong></p>
        <ul>
            <li><code>firstapp_var_22_book</code> - –ö–Ω–∏–≥–∏</li>
            <li><code>firstapp_var_22_order</code> - –ó–∞–∫–∞–∑—ã</li>
            <li><code>firstapp_var_22_user</code> - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</li>
            <li><code>firstapp_var_22_orderitem</code> - –ü–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤</li>
            <li><code>firstapp_var_22_category</code> - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
        </ul>
    </div>
</div>
{% endblock %}