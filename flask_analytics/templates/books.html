{% extends "base.html" %}

{% block title %}–ö–Ω–∏–≥–∏{% endblock %}

{% block content %}
<h1 class="mb-4">üìö –ö–Ω–∏–≥–∏ ({{ total_books }})</h1>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4">
    <div class="card-header">–§–∏–ª—å—Ç—Ä—ã</div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <input type="text" class="form-control" name="search"
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É"
                       value="{{ search }}">
            </div>
            <div class="col-md-2">
                <select class="form-control" name="category">
                    <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for cat in categories %}
                    <option value="{{ cat }}"
                            {% if category == cat %}selected{% endif %}>
                        {{ cat }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="min_price"
                       placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" value="{{ min_price }}" step="0.01">
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="max_price"
                       placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" value="{{ max_price }}" step="0.01">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥</span>
        <a href="/export/books/csv" class="btn btn-sm btn-success">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</a>
    </div>
    <div class="card-body">
        {% if books %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ê–≤—Ç–æ—Ä</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                        <th>–ì–æ–¥</th>
                        <th>–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                    <tr>
                        <td>{{ book.title }}</td>
                        <td>{{ book.authors }}</td>
                        <td>{{ book.category_name }}</td>
                        <td>{{ "%.2f"|format(book.price|float|default(0)) }} ‚ÇΩ</td>
                        <td>
                            <span class="badge bg-{% if book.stock > 10 %}success{% elif book.stock > 0 %}warning{% else %}danger{% endif %}">
                                {{ book.stock }} —à—Ç.
                            </span>
                        </td>
                        <td>{{ book.publication_year or '-' }}</td>
                        <td>
                            {% if book.available %}
                            <span class="badge bg-success">–î–æ—Å—Ç—É–ø–Ω–∞</span>
                            {% else %}
                            <span class="badge bg-danger">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if total_pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page-1 }}&search={{ search }}&category={{ category }}&min_price={{ min_price }}&max_price={{ max_price }}">
                        –ù–∞–∑–∞–¥
                    </a>
                </li>
                {% endif %}

                <li class="page-item active">
                    <span class="page-link">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}
                    </span>
                </li>

                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page+1 }}&search={{ search }}&category={{ category }}&min_price={{ min_price }}&max_price={{ max_price }}">
                        –í–ø–µ—Ä–µ–¥
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <div class="text-center py-4">
            <h4 class="text-muted">–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p class="text-muted">–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="card mt-4">
    <div class="card-header">
        –û —Ä–∞–∑–¥–µ–ª–µ "–ö–Ω–∏–≥–∏"
    </div>
    <div class="card-body">
        <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ:</p>
        <ul>
            <li>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</li>
            <li>–ò—Å–∫–∞—Ç—å –∫–Ω–∏–≥–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É</li>
            <li>–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ü–µ–Ω–µ</li>
            <li>–í–∏–¥–µ—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ</li>
            <li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ CSV —Ñ–æ—Ä–º–∞—Ç</li>
        </ul>
        <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:</strong> —Ç–∞–±–ª–∏—Ü–∞ <code>firstapp_var_22_book</code></p>
    </div>
</div>
{% endblock %}