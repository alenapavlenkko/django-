{% extends "base.html" %}

{% block title %}–ó–∞–∫–∞–∑—ã{% endblock %}

{% block content %}
<h1 class="mb-4">üõí –ó–∞–∫–∞–∑—ã ({{ total_orders }})</h1>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4">
    <div class="card-header">–§–∏–ª—å—Ç—Ä—ã</div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-2">
                <select class="form-control" name="status">
                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="pending" {% if status == 'pending' %}selected{% endif %}>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                    <option value="completed" {% if status == 'completed' %}selected{% endif %}>–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                    <option value="cancelled" {% if status == 'cancelled' %}selected{% endif %}>–û—Ç–º–µ–Ω–µ–Ω</option>
                </select>
            </div>
            <div class="col-md-3">
                <input type="date" class="form-control" name="date_from" value="{{ date_from }}">
            </div>
            <div class="col-md-3">
                <input type="date" class="form-control" name="date_to" value="{{ date_to }}">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="col-md-2">
                <a href="/orders" class="btn btn-secondary w-100">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </form>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</span>
        <a href="/export/orders/csv" class="btn btn-sm btn-success">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</a>
    </div>
    <div class="card-body">
        {% if orders %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–¢–æ–≤–∞—Ä—ã</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–û–ø–ª–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td>{{ order.created|dateformat }}</td>
                        <td>
                            {{ order.username or '–ì–æ—Å—Ç—å' }}
                            {% if order.email %}
                            <br><small class="text-muted">{{ order.email }}</small>
                            {% endif %}
                        </td>
                        <td>{{ order.items_count }} —à—Ç.</td>
                        <td>{{ "%.2f"|format(order.total|float|default(0)) }} ‚ÇΩ</td>
                        <td>
                            {% if order.status == 'completed' %}
                            <span class="badge bg-success">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                            {% elif order.status == 'pending' %}
                            <span class="badge bg-warning">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</span>
                            {% elif order.status == 'cancelled' %}
                            <span class="badge bg-danger">–û—Ç–º–µ–Ω–µ–Ω</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ order.status }}</span>
                            {% endif %}
                        </td>
                        <td>{{ order.payment_method or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if total_pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page-1 }}&status={{ status }}&date_from={{ date_from }}&date_to={{ date_to }}">
                        –ù–∞–∑–∞–¥
                    </a>
                </li>
                {% endif %}

                <li class="page-item active">
                    <span class="page-link">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}
                    </span>
                </li>

                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page+1 }}&status={{ status }}&date_from={{ date_from }}&date_to={{ date_to }}">
                        –í–ø–µ—Ä–µ–¥
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <div class="text-center py-4">
            <h4 class="text-muted">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p class="text-muted">–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="card mt-4">
    <div class="card-header">
        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
    </div>
    <div class="card-body">
        <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –º–æ–∂–µ—Ç–µ:</p>
        <ul>
            <li>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤</li>
            <li>–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ –¥–∞—Ç–µ</li>
            <li>–í–∏–¥–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö –∏ —Å—É–º–º–∞—Ö –∑–∞–∫–∞–∑–æ–≤</li>
            <li>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</li>
            <li>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</li>
        </ul>
        <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:</strong> —Ç–∞–±–ª–∏—Ü–∞ <code>firstapp_var_22_order</code></p>
    </div>
</div>
{% endblock %}